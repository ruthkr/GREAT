<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="greatR">
<title>Registering data with parameter optimisation • greatR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Lato-0.4.1/font.css" rel="stylesheet">
<link href="../deps/_Fira%20Code-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Registering data with parameter optimisation">
<meta property="og:description" content="greatR">
<meta property="og:image" content="https://ruthkr.github.io/greatR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">greatR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Overview</h6>
    <a class="dropdown-item" href="../articles/prepare-data.html">Preparing data</a>
    <a class="dropdown-item" href="../articles/register-data.html">Registering data</a>
    <a class="dropdown-item" href="../articles/visualise-results.html">Visualising results</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Optimisation</h6>
    <a class="dropdown-item" href="../articles/optimise-parameters.html">Registering data with parameter optimisation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ruthkr/greatR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="optimise-parameters_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Registering data with parameter optimisation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ruthkr/greatR/blob/HEAD/vignettes/optimise-parameters.Rmd" class="external-link"><code>vignettes/optimise-parameters.Rmd</code></a></small>
      <div class="d-none name"><code>optimise-parameters.Rmd</code></div>
    </div>

    
    
<p>Another feature provided by this package is an option for users to optimise the registration parameter values. To do this procedure, a user is given an option to initialise stretches and shifts. If a user defines stretch and shift factors boundary, the optimisation process will be processed within the boundary values initialised. If a user does not give any initialisation value, then the optimisation boundary will be automatically calculated.</p>
<div class="section level2">
<h2 id="without-boundary-initialisation">Without boundary initialisation<a class="anchor" aria-label="anchor" href="#without-boundary-initialisation"></a>
</h2>
<p>The data used on <a href="https://ruthkr.github.io/greatR/articles/register-data.html">register data</a> section will be used. To do this optimisation process, users just need to enable parameter <code>optimise_registration_parameters = TRUE</code> when using the main function <code><a href="../reference/scale_and_register_data.html">scale_and_register_data()</a></code> as shown in the figure below.</p>
<p><img src="figures/optimisation_workflow_without_initialisation.png" width="50%" style="display: block; margin: auto;"></p>
<p>As an example, we will use only one gene <code>BRAA03G023790.3C</code>, we can filter the data by doing as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gene_BRAA03G023790.3C_data</span> <span class="op">&lt;-</span> <span class="va">all_data_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">locus_name</span> <span class="op">==</span> <span class="st">"BRAA03G023790.3C"</span><span class="op">)</span>

<span class="va">gene_BRAA03G023790.3C_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">locus_name</th>
<th align="left">accession</th>
<th align="left">tissue</th>
<th align="right">timepoint</th>
<th align="right">expression_value</th>
<th align="left">group</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BRAA03G023790.3C</td>
<td align="left">Ro18</td>
<td align="left">apex</td>
<td align="right">11</td>
<td align="right">1.984367</td>
<td align="left">Ro18-11-a</td>
</tr>
<tr class="even">
<td align="left">BRAA03G023790.3C</td>
<td align="left">Ro18</td>
<td align="left">apex</td>
<td align="right">11</td>
<td align="right">1.474974</td>
<td align="left">Ro18-11-b</td>
</tr>
<tr class="odd">
<td align="left">BRAA03G023790.3C</td>
<td align="left">Ro18</td>
<td align="left">apex</td>
<td align="right">11</td>
<td align="right">2.194917</td>
<td align="left">Ro18-11-c</td>
</tr>
<tr class="even">
<td align="left">BRAA03G023790.3C</td>
<td align="left">Ro18</td>
<td align="left">apex</td>
<td align="right">29</td>
<td align="right">113.797721</td>
<td align="left">Ro18-29-a</td>
</tr>
<tr class="odd">
<td align="left">BRAA03G023790.3C</td>
<td align="left">Ro18</td>
<td align="left">apex</td>
<td align="right">29</td>
<td align="right">94.650207</td>
<td align="left">Ro18-29-b</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Running the registration</span>
<span class="va">registration_results_without_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale_and_register_data.html">scale_and_register_data</a></span><span class="op">(</span>
  input_df <span class="op">=</span> <span class="va">gene_BRAA03G023790.3C_data</span>,
  min_num_overlapping_points <span class="op">=</span> <span class="fl">4</span>,
  initial_rescale <span class="op">=</span> <span class="cn">FALSE</span>,
  do_rescale <span class="op">=</span> <span class="cn">TRUE</span>,
  accession_data_to_transform <span class="op">=</span> <span class="st">"Col0"</span>,
  accession_data_ref <span class="op">=</span> <span class="st">"Ro18"</span>,
  start_timepoint <span class="op">=</span> <span class="st">"reference"</span>, 
  maintain_min_num_overlapping_points <span class="op">=</span> <span class="cn">FALSE</span>, 
  optimise_registration_parameters <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># ── Starting optimisation ────────────────────────────────────────────────────────────────────────────</span>
<span class="co"># ℹ Using computed stretch boundary                    </span>
<span class="co"># ℹ Using computed shift boundary                      </span>
<span class="co"># ✓ Optimising registration parameters for genes (1/1) [11m 30s]</span>
<span class="co"># ✓ Finished optimisation</span>
<span class="co"># </span>
<span class="co"># ── Model comparison results ─────────────────────────────────────────────────────────────────────────</span>
<span class="co"># ℹ BIC finds registration better than non-registration for: 1/1</span>
<span class="co"># </span>
<span class="co"># ── Applying the best-shifts and stretches to gene expression ────────────────────────────────────────</span>
<span class="co"># ✓ Normalising expression by mean and sd of compared values (1/1) [20ms]</span>
<span class="co"># ✓ Applying best shift (1/1) [26ms]</span>
<span class="co"># ℹ Max value of expression_value: 1.36</span>
<span class="co"># ✓ Imputing transformed expression values (1/1) [29ms]</span></code></pre></div>
<p>After running the registration, we can then visualise the results as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">registration_results_without_boundary</span><span class="op">$</span><span class="va">imputed_mean_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">greatR</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_registration_results.html">plot_registration_results</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Registration results without boundary initialisation"</span><span class="op">)</span> </code></pre></div>
<p><img src="figures/reg_results_without_boundary_init.png" width="50%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="with-boundary-initialisation">With boundary initialisation<a class="anchor" aria-label="anchor" href="#with-boundary-initialisation"></a>
</h2>
<p>Users can also specify or initialise boundary where the optimisation will be performed by doing the same routine as the process done above, but with the stretch and shift initialisation (see figure below).</p>
<p><img src="figures/optimisation_workflow_with_initialisation.png" width="50%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Running the registration</span>
<span class="va">registration_results_with_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale_and_register_data.html">scale_and_register_data</a></span><span class="op">(</span>
  input_df <span class="op">=</span> <span class="va">gene_BRAA03G023790.3C_data</span>,
  stretches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span>, 
  shifts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
  min_num_overlapping_points <span class="op">=</span> <span class="fl">4</span>,
  initial_rescale <span class="op">=</span> <span class="cn">FALSE</span>,
  do_rescale <span class="op">=</span> <span class="cn">TRUE</span>,
  accession_data_to_transform <span class="op">=</span> <span class="st">"Col0"</span>,
  accession_data_ref <span class="op">=</span> <span class="st">"Ro18"</span>,
  start_timepoint <span class="op">=</span> <span class="st">"reference"</span>, 
  maintain_min_num_overlapping_points <span class="op">=</span> <span class="cn">FALSE</span>,
  optimise_registration_parameters <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># ── Starting optimisation ────────────────────────────────────────────────────────────────────────────</span>
<span class="co"># ℹ Using user-defined stretches as stretch boundary</span>
<span class="co"># ℹ Using user-defined shifts as shift boundary</span>
<span class="co"># ✓ Optimising registration parameters for genes (1/1) [8m 3.9s]</span>
<span class="co"># ✓ Finished optimisation</span>
<span class="co"># </span>
<span class="co"># ── Model comparison results ─────────────────────────────────────────────────────────────────────────</span>
<span class="co"># ℹ BIC finds registration better than non-registration for: 1/1</span>
<span class="co"># </span>
<span class="co"># ── Applying the best-shifts and stretches to gene expression ────────────────────────────────────────</span>
<span class="co"># ✓ Normalising expression by mean and sd of compared values (1/1) [13ms]</span>
<span class="co"># ✓ Applying best shift (1/1) [23ms]</span>
<span class="co"># ℹ Max value of expression_value: 1.36</span>
<span class="co"># ✓ Imputing transformed expression values (1/1) [20ms]</span></code></pre></div>
<p>After running the registration, we can then visualise the results as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">registration_results</span><span class="op">$</span><span class="va">imputed_mean_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">greatR</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_registration_results.html">plot_registration_results</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Registration results with boundary initialisation"</span><span class="op">)</span> </code></pre></div>
<p><img src="figures/reg_results_with_boundary_init.png" width="50%" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://ruthkr.com" class="external-link">Ruth Kristianingsih</a>, Alex Calderwood.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
