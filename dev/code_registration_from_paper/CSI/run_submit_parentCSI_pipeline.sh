#!/bin/bash

# set up environment
# activate python 3.6 conda environment - see "py36_env_details.txt" for details
source activate py36
# setup R environment - see "R_env_details.txt"
source R-3.4.4
export R_LIBS_USER="~/R/3.4.4/library"


RDS='NAME_OF_GENE_EXPRESSION_DATA_FILE'
RDS='ro18_chiifu_apex' ## REMOVE ONCE WORKING

maxNumParents=1  # the maximum allowed number of simulatneous regulators of each gene.

amalgamate='no' # How to combine the brassica paralogues of each Arabidopsis gene.
                # If NOT 'sum', then considers them seperately.

# Flowering genes of interest to include in network inference.
symbols=( "AG-AT4G18960-BRAA01G010430.3C" "AG-AT4G18960-BRAA03G048590.3C" \
"AGL15-AT5G13790-BRAA10G025090.3C" \
"AGL24-AT4G24540-BRAA03G051930.3C" \
"AGL42-AT5G62165-BRAA02G043490.3C" "AGL42-AT5G62165-BRAA09G007170.3C" \
"AGL72-AT5G51860-BRAA03G015270.3C" "AGL72-AT5G51860-BRAA03G015280.3C" "AGL72-AT5G51860-BRAA10G010460.3C" \
"AP1-AT1G69120-BRAA02G018970.3C" "AP1-AT1G69120-BRAA07G030470.3C" "AP1-AT1G69120-BRAA07G034100.3C" \
"AP2-AT4G36920-BRAA01G001670.3C" \
"AP3-AT3G54340-BRAA04G005470.3C" "AP3-AT3G54340-BRAA09G045310.3C" \
"BFT-AT5G62040-BRAA06G025510.3C" \
"CAL-AT1G26310-BRAA08G025700.3C" \
"CLV1-AT1G75820-BRAA07G027490.3C" "CLV1-AT1G75820-BRAA07G039310.3C" \
"CLV2-AT1G65380-BRAA02G016620.3C" \
"CLV3-AT2G27250-BRAA04G019630.3C" \
"CO-AT5G15840-BRAA02G006230.3C" "CO-AT5G15840-BRAA10G023720.3C" "CO-AT5G15840-BRAA10G023730.3C" \
"CRY1-AT4G08920-BRAA09G029430.3C" \
"CRY2-AT1G04400-BRAA08G034900.3C" "CRY2-AT1G04400-BRAA10G002940.3C" \
"EDF2-AT1G68840-BRAA02G018750.3C" \
"ETT-AT2G33860-BRAA04G024390.3C" "ETT-AT2G33860-BRAA05G011080.3C" \
"FD-AT4G35900-BRAA01G002650.3C" "FD-AT4G35900-BRAA03G059750.3C" \
"FLD-AT3G10390-BRAA03G034300.3C" \
"FLK-AT3G04610-BRAA03G031700.3C" \
"FT-AT1G65480-BRAA02G016700.3C" "FT-AT1G65480-BRAA07G031650.3C" \
"FUL-AT5G60910-BRAA02G042750.3C" "FUL-AT5G60910-BRAA03G043880.3C" "FUL-AT5G60910-BRAA09G006770.3C" \
"FLC-AT5G10140-BRAA02G003340.3C" "FLC-AT5G10140-BRAA03G004170.3C" "FLC-AT5G10140-BRAA03G015950.3C" "FLC-AT5G10140-BRAA10G027720.3C" \
"GA1-AT4G02780-BRAA03G028920.3C" "GA1-AT4G02780-BRAA09G001440.3C" \
"GA2OX1-AT1G78440-BRAA02G024710.3C" "GA2OX1-AT1G78440-BRAA07G041560.3C" "GA2OX1-AT1G78440-BRAA07G041570.3C" \
"GA2OX2-AT1G30040-BRAA07G010700.3C" "GA2OX2-AT1G30040-BRAA08G023600.3C" "GA2OX2-AT1G30040-BRAA09G034980.3C" \
"GA20OX1-AT4G25420-BRAA01G016120.3C" "GA20OX1-AT4G25420-BRAA03G052520.3C" \
"GA20OX2-AT5G51810-BRAA02G015640.3C" "GA20OX2-AT5G51810-BRAA10G010400.3C" \
"GA2OX7-AT1G50960-BRAA05G018600.3C" "GA2OX7-AT1G50960-BRAA08G002280.3C" \
"GA2OX8-AT4G21200-BRAA01G011970.3C" "GA2OX8-AT4G21200-BRAA03G049490.3C" "GA2OX8-AT4G21200-BRAA08G014480.3C" \
"GA3OX1-AT1G15550-BRAA06G011600.3C" "GA3OX1-AT1G15550-BRAA09G058660.3C" \
"GI-AT1G22770-BRAA09G040290.3C" \
"HFR1-AT1G02340-BRAA09G065870.3C" "HFR1-AT1G02340-BRAA10G001080.3C" \
"LFY-AT5G61850-BRAA02G043220.3C" "LFY-AT5G61850-BRAA02G043220.3C" "LFY-AT5G61850-BRAA06G025360.3C" \
"LOG1-AT2G28305-BRAA04G020220.3C" "LOG1-AT2G28305-BRAA07G018670.3C" \
"MP-AT1G19850-BRAA06G015450.3C" "MP-AT1G19850-BRAA07G016200.3C" "MP-AT1G19850-BRAA08G028060.3C" \
"NTL8-AT2G27300-BRAA07G018100.3C" \
"PI-AT5G20240-BRAA02G008770.3C" "PI-AT5G20240-BRAA03G009520.3C" "PI-AT5G20240-BRAA10G020330.3C" \
"PIF4-AT2G43010-BRAA03G022510.3C" "PIF4-AT2G43010-BRAA04G030640.3C" \
"RGA-AT2G01570-BRAA06G040430.3C" "RGA-AT2G01570-BRAA09G023210.3C" \
"RGL1-AT1G66350-BRAA02G017030.3C" \
"RGL2-AT3G03450-BRAA05G041910.3C" \
"SMZ-AT3G54990-BRAA09G045860.3C" \
"SEP4-AT2G03710-BRAA02G036180.3C" "SEP4-AT2G03710-BRAA06G039170.3C" "SEP4-AT2G03710-BRAA09G024120.3C" \
"SHB1-AT4G25350-BRAA08G020150.3C" \
"SHP1-AT3G58780-BRAA04G002560.3C" "SHP1-AT3G58780-BRAA07G023600.3C" "SHP1-AT3G58780-BRAA09G049010.3C" \
"SHP2-AT2G42830-BRAA05G003110.3C" \
"SOC1-AT2G45660-BRAA03G023790.3C" "SOC1-AT2G45660-BRAA05G005370.3C" \
"SPL1-AT2G47070-BRAA05G000760.3C" \
"SPL2-AT5G43270-BRAA06G043820.3C" "SPL2-AT5G43270-BRAA09G019680.3C" \
"SPL3-AT2G33810-BRAA03G017890.3C" "SPL3-AT2G33810-BRAA04G024340.3C" "SPL3-AT2G33810-BRAA05G011150.3C" \
"SPL4-AT1G53160-BRAA05G017340.3C" "SPL4-AT1G53160-BRAA06G001520.3C" \
"SPL5-AT3G15270-BRAA01G036840.3C" "SPL5-AT3G15270-BRAA05G031900.3C" \
"SPL6-AT1G69170-BRAA02G019010.3C" "SPL6-AT1G69170-BRAA07G034120.3C" \
"SPL7-AT5G18830-BRAA02G007860.3C" "SPL7-AT5G18830-BRAA10G021370.3C" \
"SPL9-AT2G42200-BRAA04G029680.3C" "SPL9-AT2G42200-BRAA05G002720.3C" \
"SPL10-AT1G27370-BRAA07G012240.3C" "SPL10-AT1G27370-BRAA09G037110.3C" \
"SPL11-AT1G27360-BRAA07G012230.3C" "SPL11-AT1G27360-BRAA08G024970.3C" "SPL11-AT1G27360-BRAA09G037100.3C" \
"SPL14-AT1G20980-BRAA06G016480.3C" \
"SPL15-AT3G57920-BRAA04G003010.3C" \
"NA-AT1G76580-BRAA02G023550.3C" "NA-AT1G76580-BRAA07G040210.3C" \
"SEP1-AT5G15800-BRAA03G007090.3C" "SEP1-AT5G15800-BRAA10G023780.3C" \
"SEP3-AT1G24260-BRAA07G012310.3C" "SEP3-AT1G24260-BRAA08G025030.3C" \
"STK-AT4G09960-BRAA03G027090.3C" "STK-AT4G09960-BRAA09G028450.3C" \
"SUC2-AT1G22710-BRAA07G014520.3C" "SUC2-AT1G22710-BRAA09G040330.3C" \
"SVP-AT2G22540-BRAA04G016520.3C" "SVP-AT2G22540-BRAA09G054750.3C" \
"TEM1-AT1G25560-BRAA08G025570.3C" "TEM1-AT1G25560-BRAA09G038140.3C" \
"TEM2-AT1G68840-BRAA02G018750.3C" \
"TFL1-AT5G03840-BRAA02G001100.3C" "TFL1-AT5G03840-BRAA03G001350.3C" "TFL1-AT5G03840-BRAA10G032420.3C" \
"TOE1-AT2G28550-BRAA03G024840.3C" "TOE1-AT2G28550-BRAA07G018940.3C" \
"TOE2-AT5G60120-BRAA02G010430.3C" "TOE2-AT5G60120-BRAA10G017850.3C" \
"TOE3-AT5G67180-BRAA07G016770.3C" \
"VIN3-AT5G57380-BRAA02G012310.3C" "VIN3-AT5G57380-BRAA03G012460.3C" "VIN3-AT5G57380-BRAA06G040160.3C" \
"VEL3-AT2G18870-BRAA06G029730.3C" \
"WRI-AT3G54320-BRAA07G021670.3C" "WRI-AT3G54320-BRAA09G045300.3C" \
"CNGC15-AT2G28260-BRAA07G018660.3C" )


seen=('dummy')
for target in "${symbols[@]}"
do
  if [ $amalgamate = 'sum' ]; then
    target=`echo $target | cut -d- -f1-2` # assign target to be the arabidopsis identifier if amalgamating.
    # problem is this potentially starts the same target job running many times! - so script checks if seen before to prevent.
  fi
  inarray=$(echo ${seen[@]} | grep -o $target | wc -w)
  if [ $inarray = 0 ]; then
    echo ${target}
    sbatch ./submit_parentCSI_pipeline.sh $RDS $maxNumParents $target $amalgamate "${symbols[@]}"
    seen+=($target)
  fi
done

# deactivate py36 conda environment
source deactivate py36
