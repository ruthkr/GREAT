---
title: "Optimising parameters"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{optimise_parameters}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Another feature that this package provides is option for users to optimise the parameters value while running the registration process. There are two options to do this process, if a user initialises stretch and shift factors, the optimisation process will be processed within the values initialised. If a user does not give any initialisation value, then the optimisation boundary will be automatically calculated. 

<br>

```{r opt-data-with-initial, echo=FALSE, out.width='50%'}
knitr::include_graphics("figures/optimisation_workflow_with_initialisation.png")
```

```{r opt-data-without-initial, echo=FALSE, out.width='50%'}
knitr::include_graphics("figures/optimisation_workflow_without_initialisation.png")
```

<br>

As an example, the data used on [register data](https://ruthkr.github.io/greatR/articles/register-data.html) section will be used. To do this optimisation process, we just need put parameter `optimise_registration_parameters = TRUE` when using the main function `scale_and_register_data()`. 

```{r example, message=FALSE, include=FALSE}
# Load the package
library(greatR)
library(dplyr)
```

```{r all-data, message=FALSE, warning=FALSE, include=FALSE}
# Gene expression data with replicates
all_data_df <- system.file("extdata/brapa_arabidopsis_all_replicates.csv", package = "greatR") %>%
  utils::read.csv()
```

```{r register-data, message=FALSE, warning=FALSE}
# Running the registration
registration_results <- scale_and_register_data(
  input_df = all_data_df,
  min_num_overlapping_points = 4,
  initial_rescale = FALSE,
  do_rescale = TRUE,
  accession_data_to_transform = "Col0",
  accession_data_ref = "Ro18",
  start_timepoint = "reference", 
  optimise_shift_extreme = FALSE,
  optimise_registration_parameters = TRUE,
  boundary_coverage = 1
)
```
